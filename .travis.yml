language: go
os:
  - linux
go:
  - 1.7.3
install:
  - sudo apt-get install -qq upx
  - go get github.com/Sirupsen/logrus
  - go get github.com/getblank/wango
  - go get github.com/spf13/cobra
  - go get github.com/ivahaev/verlog
  - chmod +x sender.sh
script: go get -t -v ./...
after_success:
  - go build -o blank-fs-linux-amd64 -ldflags "-X main.buildTime=`date +%Y-%m-%d:%H:%M:%S` -X main.gitHash=`git rev-parse --short HEAD`"
  - upx --best blank-fs-linux-amd64
  - curl --ftp-create-dirs --data-binary -k -T ./blank-fs-linux-amd64 -u $FTP_USER:$FTP_PASSWORD ftp://releases.getblank.net/releases/blank-fs/linux/blank-fs
  - if [[ ${TRAVIS_TAG} ]]; then
      curl --ftp-create-dirs --data-binary -k -T ./blank-fs-linux-amd64 -u $FTP_USER:$FTP_PASSWORD ftp://releases.getblank.net/releases/blank-fs/${TRAVIS_TAG}/blank-fs-linux-amd64;
    fi

  - GOOS=darwin GOARCH=amd64 go build -o blank-fs-darwin-amd64 -ldflags "-X main.buildTime=`date +%Y-%m-%d:%H:%M:%S` -X main.gitHash=`git rev-parse --short HEAD`"
  - curl --ftp-create-dirs --data-binary -k -T ./blank-fs-darwin-amd64 -u $FTP_USER:$FTP_PASSWORD ftp://releases.getblank.net/releases/blank-fs/osx/blank-fs
  - if [[ ${TRAVIS_TAG} ]]; then
      curl --ftp-create-dirs --data-binary -k -T ./blank-fs-darwin-amd64 -u $FTP_USER:$FTP_PASSWORD ftp://releases.getblank.net/releases/blank-fs/${TRAVIS_TAG}/blank-fs-darwin-amd64;
    fi
  - ./sender.sh

deploy:
  provider: releases
  api_key: "$GITHUB_OAUTH_TOKEN"
  file:
    - blank-fs-linux-amd64
    - blank-fs-darwin-amd64
  skip_cleanup: true
  on:
    tags: true